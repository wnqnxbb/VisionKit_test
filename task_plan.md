# Task Plan: Camera -> Subject Extraction -> Gallery

## Goal
Build an iOS app flow that:
- shows a single "Take Photo" button (system camera UI)
- after capture, automatically extracts the most prominent subject (largest instance) via Vision foreground instance segmentation
- creates a transparent-background cutout PNG, saves it locally
- persists metadata with SwiftData
- displays saved subject cutouts in a grid on the same screen

## Non-Goals (for v1)
- user choosing among multiple detected subjects
- editing (manual refine mask), background replacement, sharing
- cloud sync / photo library saving

## Constraints / Assumptions
- iOS deployment target: 26.2 (project setting)
- Info.plist is generated by Xcode; add camera usage key via build settings
- Storage: app sandbox Documents directory; SwiftData stores filenames + timestamps

## Phases
| Phase | Status | Deliverable |
|------:|:------:|-------------|
| 0 | complete | Planning files + design doc |
| 1 | in_progress | SwiftData model for saved cutouts + migration from template Item |
| 2 | pending | System camera sheet (UIImagePickerController) integrated in SwiftUI |
| 3 | pending | Subject extraction pipeline: Vision mask -> CI mask compositing -> PNG export |
| 4 | pending | Save/load images from Documents + grid UI with delete |
| 5 | pending | Permissions (NSCameraUsageDescription) + user-facing error states |
| 6 | pending | Tests for core logic (selection/cropping/path) + basic verification steps |

## Acceptance Criteria
- Tap button -> system camera opens -> capture -> app shows processing -> then grid shows new cutout
- If multiple subjects detected -> selects the largest instance automatically
- Cutout image has transparent background (PNG with alpha)
- On relaunch, previously saved cutouts still show
- Camera permission prompt shows meaningful text

## Open Risks
- Vision foreground instance masks can fail on some images; need clear error fallback UI
- Performance: large images may be slow; may need downscale for mask generation then apply on full-res
